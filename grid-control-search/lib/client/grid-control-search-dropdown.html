<template name="grid_control_search_dropdown">
  <div class="search-dropdown">
    {{#if resultTasks}}
      <div class="search-dropdown-nav">
        <div class="search-dropdown-nav-link tasks text-primary active">
          Tasks ({{resultTasksCount}})
          <div class="search-dropdown-nav-indicator bg-primary"></div>
        </div>
        <div class="search-dropdown-nav-link chats text-primary">
          Chats (0)
          <div class="search-dropdown-nav-indicator bg-primary"></div>
        </div>
      </div>
      {{#if filters}}
        <div class="search-dropdown-filters">
          {{#each filters}}
            <div class="filter-item bg-primary">
              {{title}}: {{value}}
              <svg class="filter-item-remove jd-icon"><use xlink:href="/layout/icons-feather-sprite.svg#x"></use></svg>
            </div>
          {{/each}}
        </div>
      {{/if}}
      <div class="search-result-list">
        {{#each resultTasks}}
          <div class="search-result-item" data-path="{{path}}">
            {{#if parents}}
              {{#unless showFullContext}}
                <div class="task-parent-title">
                  {{{xssGuard immediateParent.title noFormatting=true}}}
                  <svg class="jd-icon"><use xlink:href="/layout/icons-feather-sprite.svg#corner-down-right"></use></svg>
                </div>
              {{else}}
                {{#if taskHasMoreThanXParents}}
                  <div class="task-parent-title">
                    ...
                    <svg class="jd-icon"><use xlink:href="/layout/icons-feather-sprite.svg#corner-down-right"></use></svg>
                  </div>
                {{/if}} 

                {{#each parent in lastXParents}}
                  <div class="task-parent-title" style="margin-left: {{getParentMargin @index (taskHasMoreThanXParents)}}px">
                    {{{xssGuard parent.title noFormatting=true}}}
                    <svg class="jd-icon"><use xlink:href="/layout/icons-feather-sprite.svg#corner-down-right"></use></svg>
                  </div>
                {{/each}}
              {{/unless}}
            {{/if}}
            <div class="task-title" style="{{#if parents}}margin-left: {{getTaskMargin}}px{{/if}}">
              <span class="task-seq-id">{{{xssGuard(_ "grid_control_search_task_with_seq_id_prefix" seqId=seqId) noFormatting=true}}}</span> {{{xssGuard title noFormatting=true}}}
            </div>
            <div class="task-info" style="{{#if parents}}margin-left: {{getTaskMargin}}px{{/if}}">
              {{#if state}}
                <span class="task-info-state">{{_ "grid_control_search_state_prefix"}}</span>{{{xssGuard state noFormatting=true}}}
              {{/if}}
              {{#if $and state note}}
                <br>
              {{/if}}
              {{#if note}}
                <span class="task-info-note">{{_ "grid_control_search_note_prefix"}}</span>{{{xssGuard note noFormatting=true}}}
              {{/if}}
            </div>
          </div>
        {{/each}}
        <div class="search-show-context">
          {{#if showFullContext}}
            <div class="search-show-context-toggle">Hide context</div>
            <svg class="jd-icon search-show-context-toggle text-primary"><use xlink:href="/layout/icons-feather-sprite.svg#toggle-right"></use></svg>
          {{else}}
            <div class="search-show-context-toggle">Show full context</div>
            <svg class="jd-icon search-show-context-toggle"><use xlink:href="/layout/icons-feather-sprite.svg#toggle-left"></use></svg>
          {{/if}}
        </div>
      </div>
    {{else}}
      <div class="search-result-empty">
        No results were found for your search
      </div>
    {{/if}}
  </div>
</template>

<template name="justdo_calendar_project_pane">

    <div class="calendar_view_header p-2">
      <div class="calendar_view_project_selector dropdown">
        <button class="btn btn-light btn-sm border" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
          Entire JustDo
        </button>
        <ul class="dropdown-menu jd-p-075 animate slideIn shadow-lg border-0">
          <li><a href="#" class="dropdown-item px-1" project_id="*">Entire JustDo</a></li>
          {{#if projectsInJustDo}}
            <hr class="my-2 border-light">
            <li class="dropdown-header text-muted text-uppercase px-1 py-0">Projects</li>
            {{#each projectsInJustDo}}
              <li><a href="#" class="dropdown-item px-1" project_id={{_id}}>{{title}}</a></li>
            {{/each}}
          {{/if}}
        </ul>
      </div>

      <div class="calendar_view_date_selector">
        Display Calendar for {{title_date}}
        <div class="btn-group ml-3" role="group">
          <button type="button" class="btn btn-light btn-sm border calendar-view-prev-week"><svg class="calendar_view_date_icon"><use xlink:href="/layout/icons-feather-sprite.svg#chevrons-left"/></svg></button>
          <button type="button" class="btn btn-light btn-sm border calendar-view-prev-day"><svg class="calendar_view_date_icon"><use xlink:href="/layout/icons-feather-sprite.svg#chevron-left"/></svg></button>
          <button type="button" class="btn btn-light btn-sm border calendar-view-back-to-today">This Week</button>
          <button type="button" class="btn btn-light btn-sm border calendar-view-next-day"><svg class="calendar_view_date_icon"><use xlink:href="/layout/icons-feather-sprite.svg#chevron-right"/></svg></button>
          <button type="button" class="btn btn-light btn-sm border calendar-view-next-week"><svg class="calendar_view_date_icon"><use xlink:href="/layout/icons-feather-sprite.svg#chevrons-right"/></svg></button>
        </div>
        <div class="btn-group ml-2" role="group">
          <button type="button" class="btn btn-light btn-sm border calendar_view_zoom_in"><svg class="calendar_view_date_icon"><use xlink:href="/layout/icons-feather-sprite.svg#zoom-in"/></svg></button>
          <button type="button" class="btn btn-light btn-sm border calendar_view_zoom_out"><svg class="calendar_view_date_icon"><use xlink:href="/layout/icons-feather-sprite.svg#zoom-out"/></svg></button>
        </div>
      </div>
    </div>

    <div class="calendar_view_main_table_wrapper calendar-view-{{calendarViewResolution}}">
      <div class="sticky-avatar-helper"></div>
      <table class="main_table_fixed_header" width="100%">
        <thead>
          <tr>
            <th class="calendar_view_user">
              <div class="calendar_expand_collapse d-flex align-items-center">
                <div title="Expand all">
                  <svg class="jd-icon expand_all"><use xlink:href="/layout/icons-feather-sprite.svg#plus"/></svg>
                </div>
                <div class="expand_collapse_divider border-left"></div>
                <div title="Collapse all">
                  <svg class="jd-icon collapse_all"><use xlink:href="/layout/icons-feather-sprite.svg#minus"/></svg>
                </div>
              </div>
            </th>
            <th class="calendar_view_move"></th>
            {{#each datesToDisplay}}
              <th class="{{#if isToday this}}is_today{{/if}} {{isHoliday this}} {{#if isFirstDayOfWeek this}}is_start_of_week{{/if}}">{{{formatDate}}}</th>
            {{/each}}
            <th class="calendar_view_move"></th>
          </tr>
        </thead>
      </table>
      <table class="calendar_view_main_table" width="100%">
        <thead>
          <tr>
            <th class="calendar_view_user">
              <div class="calendar_expand_collapse d-flex align-items-center">
                <div title="Expand all">
                  <svg class="jd-icon expand_all"><use xlink:href="/layout/icons-feather-sprite.svg#plus"/></svg>
                </div>
                <div class="expand_collapse_divider border-left"></div>
                <div title="Collapse all">
                  <svg class="jd-icon collapse_all"><use xlink:href="/layout/icons-feather-sprite.svg#minus"/></svg>
                </div>
              </div>
            </th>
            <th class="calendar_view_move"></th>
            {{#each datesToDisplay}}
              <th class="calendar_view_date {{#if isToday this}}is_today{{/if}} {{isHoliday this}} {{#if isFirstDayOfWeek this}}is_start_of_week{{/if}}">{{{formatDate}}}</th>
            {{/each}}
            <th class="calendar_view_move"></th>
          </tr>
        </thead>
        {{> justdo_calendar_project_pane_user_view tasks_set=currentUserTasksSet dependency=currentUserDependency user_id=currentUserId dates_to_display=datesToDisplay delivery_planner_project_id=deliveryPlannerProjectId show_navigation=true}}
        {{#each allOtherUsers}}
          {{> justdo_calendar_project_pane_user_view tasks_set=userTasksSet dependency=userDependency user_id=this dates_to_display=datesToDisplay show_navigation=false}}
        {{/each}}
      </table>
    </div>
</template>


<template name="justdo_calendar_project_pane_user_view">

  {{#if isCollapsed}}
    <tr class="calendar_view_tasks_row is_collapsed" user_id={{userId}}>
      <td class="calendar_table_user">
        {{#with userObj}}
          <div class="d-flex justify-content-center position-relative">
            <div class="calendar_table_user_name shadow-sm rounded-sm">{{userName userId}}</div>
            <button class="btn btn-primary jd-btn-xsm text-uppercase font-weight-bold expand_user">{{userInitials userId}}</button>
          </div>
        {{/with}}
      </td>
      {{#if showNavigation}}
        <td class="calendar_view_scroll_left_cell calendar_view_scroll_cell" rowspan="{{navRowspan}}">
          <svg class="calendar_view_date_icon"><use xlink:href="/layout/icons-feather-sprite.svg#chevrons-left"/></svg>
        </td>
      {{/if}}
      {{#each colNumbers}}
        <td class="calendar_view_resources {{markDaysOff}}" date={{columnDate}}>{{#unless markDaysOff}}{{{xssGuard bottomLine}}}{{/unless}}</td>
      {{/each}}
    </tr>
  {{else}}
    {{#each rowNumbers}}
      <tr class="calendar_view_tasks_row" user_id={{userId}}>
        {{#if firstRow}}
          <td class="calendar_table_user" rowspan={{numberOfRows}}>
            {{#with userObj}}
              <div class="collapse_user">
                {{> justdo_avatar}}
              </div>
              <!-- <div class="calendar_view_expand_collapse" title="Collapse user">
                <svg class="jd-icon collapse_user border border-primary shadow-sm"><use xlink:href="/layout/icons-feather-sprite.svg#minus"/></svg>
              </div> -->
              <div class="calendar_view_clock" title="Set Resources Availability">
                <svg class="jd-icon clock shadow-sm"><use xlink:href="/layout/icons-feather-sprite.svg#clock"/></svg>
              </div>
            {{/with}}
          </td>
          {{#if showNavigation}}
            <td class="calendar_view_scroll_left_cell calendar_view_scroll_cell" rowspan="{{navRowspan}}">
              <svg class="calendar_view_date_icon"><use xlink:href="/layout/icons-feather-sprite.svg#chevrons-left"/></svg>
            </td>
          {{/if}}
        {{/if}}
        {{#each colNumbers}}
          {{#unless skipTD}}
              {{#if taskId}}
                {{#with cellData}}
                  <td class="calendar_table_cell" date={{columnDate}} colspan={{span}}>
                    <div class="calendar_task_cell calendar_view_draggable {{dimTask}} task_cell_{{type}}" title="{{projectName}}{{task.title}}" task_id="{{task._id}}" task_users="{{task.users}}" type={{type}}>
                      <div class="calendar_task_info">
                        {{#if showType type}}
                          <div class="calendar_task_type {{fontSizeClass}}">{{type}}</div>
                        {{/if}}
                        {{#if startDateAfterDueDate}}
                          <div class="calendar_task_startDateAfterDueDate {{fontSizeClass}}" title="Start Date after Due Date">!</div>
                        {{/if}}
                        {{#if hasDueDate}}
                          <div class="calendar_task_due_date {{fontSizeClass}}">{{dueDate}}</div>
                        {{/if}}
                        {{#if unassignedHours}}
                          <div class="calendar_task_unassigned_hours {{fontSizeClass}}">{{unassignedHours}}</div>
                        {{/if}}
                        {{#if plannedHours}}
                          <div class="calendar_task_planned_hours {{fontSizeClass}}">{{plannedHours}}</div>
                        {{/if}}
                      </div>
                      <!-- {{#unless hideDuePendingOwner}}
                        <i class="fa fa-map-marker calendar_view_draggable" task_id="{{task._id}}"aria-hidden="true"></i>
                      {{/unless}} -->
                      {{#if startsBeforeView}}
                        <div class="calendar_task_startsBeforeView {{fontSizeClass}}">
                          <svg class="calendar_view_icon"><use xlink:href="/layout/icons-feather-sprite.svg#chevron-left"/></svg>
                        </div>
                      {{/if}}
                      <div class="calendar_task_id {{fontSizeClass}}">#{{task.sequence_id}}</div>
                      <div class="calendar_task_title {{fontSizeClass}}">{{projectName}}{{task.title}}</div>
                      <!-- ({{task.state}}) -->
                      {{#if endsAfterView}}
                        <div class="calendar_task_endsAfterView {{fontSizeClass}}">
                          <svg class="calendar_view_icon"><use xlink:href="/layout/icons-feather-sprite.svg#chevron-right"/></svg>
                        </div>
                      {{/if}}
                    </div>
                  </td>
                {{/with}}
              {{else}}
                <td class="calendar_table_cell {{markDaysOff}}" date={{columnDate}}></td>
              {{/if}}
          {{/unless}}
        {{/each}}
        {{#if firstRow}}
          {{#if showNavigation}}
            <td class="calendar_view_scroll_right_cell calendar_view_scroll_cell" rowspan="{{navRowspan}}">
              <svg class="calendar_view_date_icon"><use xlink:href="/layout/icons-feather-sprite.svg#chevrons-right"/></svg>
            </td>
          {{/if}}
        {{/if}}
      </tr>
    {{/each}}
    <!--  lets add a dropable line-->
    <tr user_id={{userId}}>
      {{#each colNumbers}}
        <td class="calendar_view_resources {{markDaysOff}} {{fontSizeClass}}" date={{columnDate}}>{{#unless markDaysOff}}{{{xssGuard bottomLine}}}{{/unless}}</td>
      {{/each}}
    </tr>
  {{/if}}

</template>

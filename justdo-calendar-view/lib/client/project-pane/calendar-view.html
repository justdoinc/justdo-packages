<template name="justdo_calendar_project_pane">

    <div class="calendar_view_header">
      <select class="calendar_view_project_selector">
        <option value="*" data-content="Pending">Entire JustDo</option>
        {{#each projectsInJustDo}}
          <option value={{_id}} data-content="Pending">{{title}}</option>
        {{/each}}
      </select>
      <div class="calendar_view_date_selector">
        Display Calendar for {{title_date}}
        <div class="btn-group" role="group">
          <button type="button" class="btn btn-default calendar-view-prev-week"><svg class="calendar_view_date_icon"><use xlink:href="/layout/icons-feather-sprite.svg#chevrons-left"/></svg></button>
          <button type="button" class="btn btn-default calendar-view-prev-day"><svg class="calendar_view_date_icon"><use xlink:href="/layout/icons-feather-sprite.svg#chevron-left"/></svg></button>
          <button type="button" class="btn btn-default calendar-view-back-to-today">This Week</button>
          <button type="button" class="btn btn-default calendar-view-next-day"><svg class="calendar_view_date_icon"><use xlink:href="/layout/icons-feather-sprite.svg#chevron-right"/></svg></button>
          <button type="button" class="btn btn-default calendar-view-next-week"><svg class="calendar_view_date_icon"><use xlink:href="/layout/icons-feather-sprite.svg#chevrons-right"/></svg></button>
        </div>
      </div>
    </div>

    <div class="calendar_view_main_table_wrapper">
      <table class="calendar_view_main_table"  width="100%">
        <tr>
          <th class="calendar_view_user"></th>
          <th class="calendar_view_move"></th>
          {{#each datesToDisplay}}
            <th class="calendar_view_date {{#if isToday this}}is_today{{/if}}">{{{formatDate}}}</th>
          {{/each}}
          <th class="calendar_view_move"></th>
        </tr>
        {{> justdo_calendar_project_pane_user_view user_id=currentUserId dates_to_display=datesToDisplay delivery_planner_project_id=deliveryPlannerProjectId show_navigation=true}}
        {{#each allOtherUsers}}
          {{> justdo_calendar_project_pane_user_view user_id=this dates_to_display=datesToDisplay show_navigation=false}}
        {{/each}}
      </table>
    </div>
</template>


<template name="justdo_calendar_project_pane_user_view">
  {{#each rowNumbers}}
    <tr class="calendar_view_tasks_row" user_id={{userId}}>
      {{#if firstRow}}
        <td class="calendar_table_user" rowspan={{numberOfRows}}>
          {{#with userObj}}
            {{> justdo_avatar}}
          {{/with}}
        </td>
        {{#if showNavigation}}
          <td class="calendar_view_scroll_left_cell calendar_view_scroll_cell" rowspan="{{navRowspan}}">
            <svg class="calendar_view_date_icon"><use xlink:href="/layout/icons-feather-sprite.svg#chevrons-left"/></svg>
          </td>
        {{/if}}
      {{/if}}
      {{#each colNumbers}}
        {{#unless skipTD}}
            {{#if taskId}}
              {{#with cellData}}
                <td class="calendar_table_cell" date={{columnDate}} colspan={{span}}>
                  <div class="calendar_task_cell calendar_view_draggable {{dimWhenPendingOwner}}" task_id="{{task._id}}" task_users="{{task.users}}" type={{type}}>
                    <div class="calendar_task_info">
                      <div class="calendar_task_type">{{type}}</div>
                      {{#if startDateAfterDueDate}}
                        <div class="calendar_task_startDateAfterDueDate" title="Start Date after Due Date">!</div>
                      {{/if}}
                      {{#if unassignedHours}}
                        <div class="calendar_task_unassigned_hours">{{unassignedHours}}</div>
                      {{/if}}
                      {{#if plannedHours}}
                        <div class="calendar_task_planned_hours">{{plannedHours}}</div>
                      {{/if}}
                    </div>
                    <!-- {{#unless hideDuePendingOwner}}
                      <i class="fa fa-map-marker calendar_view_draggable" task_id="{{task._id}}"aria-hidden="true"></i>
                    {{/unless}} -->
                    {{#if startsBeforeView}}
                      <div class="calendar_task_startsBeforeView">
                        <svg class="calendar_view_icon"><use xlink:href="/layout/icons-feather-sprite.svg#chevron-left"/></svg>
                      </div>
                    {{/if}}
                    <div class="calendar_task_id">#{{task.sequence_id}}</div>
                    <div class="calendar_task_title">{{task.title}}</div>
                    <!-- ({{task.state}}) -->
                    {{#if endsAfterView}}
                      <div class="calendar_task_endsAfterView">
                        <svg class="calendar_view_icon"><use xlink:href="/layout/icons-feather-sprite.svg#chevron-right"/></svg>
                      </div>
                    {{/if}}
                  </div>
                </td>
              {{/with}}
            {{else}}
              <td class="calendar_table_cell {{markDaysOff}}" date={{columnDate}}></td>
            {{/if}}
        {{/unless}}
      {{/each}}
      {{#if firstRow}}
        {{#if showNavigation}}
          <td class="calendar_view_scroll_right_cell calendar_view_scroll_cell" rowspan="{{navRowspan}}">
            <svg class="calendar_view_date_icon"><use xlink:href="/layout/icons-feather-sprite.svg#chevrons-right"/></svg>
          </td>
        {{/if}}
      {{/if}}
    </tr>
  {{/each}}
  <!--  lets add a dropable line-->
  <tr user_id={{userId}}>
    {{#each colNumbers}}
      <td class="calendar_view_resources {{markDaysOff}}" date={{columnDate}} >{{bottomLine}}</td>
    {{/each}}
  </tr>

</template>

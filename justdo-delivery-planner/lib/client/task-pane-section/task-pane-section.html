<template name="task_pane_justdo_delivery_planner_task_pane_section_section">
  {{#if resourcePlannerIsEnabled}}
    {{> delivery_planner_task_pane_main}}
  {{else}}
    <div class="missing-dependency">
      The Projects Plugin depends on the Resource Management plugin, please enable it to continue.
    </div>
  {{/if}}
</template>

<template name="delivery_planner_task_pane_main">
  <div class="delivery-planner {{#if isSmallLayout}}small-layout{{/if}}">
    <div class="is-project-toggle {{#if isProject}}is-project{{/if}}" >
      {{#if isProject}}
        <i class="fa fa-toggle-on fa-fw"></i>
      {{else}}
        <i class="fa fa-toggle-off fa-fw"></i>
      {{/if}}

      Set as Project

    </div>

    <ul class="nav nav-tabs border-0">
      {{#if isProject}}
        <li role="presentation" tab-id="project" class="delivery-planner-tab {{#if $eq currentTab "project"}}active{{/if}}"><a href="#">Project {{#if isArchived}}(closed){{/if}}</a></li>
      {{/if}}

      <li role="presentation" tab-id="assign" class="delivery-planner-tab {{#if $eq currentTab "assign"}}active{{/if}}"><a href="#">Assign to Projects</a></li>
    </ul>

    <div class="resource-planner-tab {{currentTab}}">
      {{#if $eq currentTab "project"}}
        {{> delivery_planner_task_pane_project_tab}}
      {{else if $eq currentTab "assign"}}
        {{> delivery_planner_task_pane_assign_tab}}
      {{/if}}
    </div>
  </div>
</template>

<template name="delivery_planner_task_pane_project_tab">
  <section>
    <div class="refresh">
      <i class="fa fa-refresh fa-fw refresh" title="Refresh chart"></i>
    </div>

    <h2>Burn Down Chart</h2>

    {{#if burndownDataPending}}
      <div class="burndown-data-not-ready">
        <p>Loading chart...</p>
      </div>
    {{else if $not isHighchartsReady}}
      <div class="highcharts-not-ready">
        <p>Loading chart...</p>
      </div>
    {{else if sufficientDataForChart}}
      {{> delivery_planner_task_pane_project_tab_burndown_chart}}
    {{else}}
      <div class="insufficiant-data-message">
        <p>Not enough information to generate the project burn down chart.</p>

        <p>Please set the planned resources for the project's tasks.</p>
      </div>
    {{/if}}
  </section>

  <section>
    <h2>Project settings</h2>

    <div class="dp-project-setting">
      <div class="setting-label">Project start date</div>

      <div class="setting-controller">{{> delivery_planner_task_pane_project_tab_start_date_field_editor}}</div>

      <div class="clearfix"></div>
    </div>

    <div class="dp-project-setting">
      <div class="setting-label">Project workdays</div>

      <div class="setting-controller">
        <span class="project-workday-list">{{humanReadableProjectWorkdays}}</span>

        {{> delivery_planner_task_pane_workdays_editor_btn workdays_editor=getWorkdaysEditorController}}

      </div>

      <div class="clearfix"></div>
    </div>

    <div class="dp-project-setting">
      <div class="refresh" title="Refresh project members list

The project members list includes all the members that have planned hours in the project's tasks.">
        <i class="fa fa-refresh fa-fw"></i>
      </div>

      <div class="setting-label">Members availability hours per workday</div>

      <div class="clearfix"></div>
    </div>

    {{#if taskHasMembersAvailabilityRecords}}
      {{> delivery_planner_task_pane_project_tab_members_avail_table}}
    {{else}}
      <div class="no-project-members-message">
        <p>This project doesn't have any members.</p>

        <p>Go to the Resources tab of the tasks to which you want to plan time, and set the planned time for each project member for each task.</p>
      </div>
    {{/if}}

    <!--
    <div class="dp-project-setting">
      <div class="setting-label">Commit to project plan <span class="commit-project-plan-more-info" title="Once you commit to a project plan, we take a snapshot of the current project Start Date, Resources, and Members Availability.

We use this snapshot to calculate the Ideal Work Remaining Line of the Burn Down Chart, with which you can analyze your progress in comparison to the plan."><i class="fa fa-question-circle fa-fw"></i></span></div>

      <div class="setting-controller">
        {{#if isCommitted}}
          <span class="dp-committed">Committed: {{formattedCommitDate}}</span>
          <br>
          <div class="btn btn-default btn-xs dp-uncommit-to-project-plan">Remove Commitment</div>
        {{else}}
          <div class="btn btn-default btn-xs dp-commit-to-project-plan">Commit to Plan</div>
        {{/if}}
      </div>

      <div class="clearfix"></div>
    </div>
    -->

    <div class="dp-project-setting">
      <div class="setting-label">{{#if isArchived}}Reopen{{else}}Close{{/if}} project <span class="archive-project-more-info" title="Closed projects aren't showing in the tasks' 'Assign to Project' tab, and are showing separately from the active, non-closed, projects in the grid."><i class="fa fa-question-circle fa-fw"></i></span></div>

      <div class="setting-controller">
        <div class="btn btn-default btn-xs dp-archive-project">{{#if isArchived}}Reopen{{else}}Close{{/if}}</div>
      </div>

      <div class="clearfix"></div>
    </div>
  </section>
</template>

<template name="delivery_planner_task_pane_project_tab_start_date_field_editor">
  <div class="field-editor" style="width: 100px">START DATE</div>
</template>

<template name="delivery_planner_task_pane_project_tab_members_avail_table">
  <div class="members-avail-table-wrapper">

    <table class="table">
      {{#each membersAvailabilityProxy.members}}
        {{> delivery_planner_task_pane_project_tab_member_availability}}
      {{/each}}
    </table>

  </div>

  {{#if membersAvailabilityProxy.changed.get}}
    <div class="btn btn-primary btn-sm dp-save-members-availability">Save Availability</div>
    <div class="btn btn-default btn-sm dp-cencel-members-availability">Cancel</div>
  {{/if}}

  <div class="clearfix"></div>
</template>

<template name="delivery_planner_task_pane_project_tab_member_availability">
  <tr member-id="{{user_id}}">
    <td class="member-name">{{#with user_doc}}{{displayName}}{{/with}}</td>
    <td class="daily-avail {{#if $eq getAvailabilityType "extended"}}daily-avail-extended-td{{/if}}">
      {{#if $eq getAvailabilityType "simple"}}
        <div class="daily-avail-simple">
          <div class="input-group">
            <input type="text" class="form-control simple-daily-availability" value="{{getFormattedSimpleDailyAvailability}}" placeholder="{{placeholder}}">
            <div class="input-group-addon">Hours</div>
          </div>
          <div class="btn btn-default btn-sm customize-daily-availability">Custom</div>
        </div>
      {{else}}
        <div class="daily-avail-extended">
          <div class="daily-avail-extended-content">
            <div class="daily-avail-extended-content-workdays">
              <div class="daily-avail-extended-header">Workdays {{> delivery_planner_task_pane_extended_workdays_editor_btn member_controller=this}}</div>

              {{{humanReadableExtendedDailyAvailability}}}
            </div>

            <div class="daily-avail-extended-content-daysoffs">
              <div class="daily-avail-extended-header">Days off {{> delivery_planner_task_pane_add_daysoff_btn member_controller=this}}</div>

              {{#with getDaysoffRanges}}
                <ul class="list-unstyled">
                  {{#each this}}
                    <li item-index="{{index}}">
                      <span class="dayoff-bullet">&#8226;</span> {{start}} - {{end}} <div class="daily-avail-extended-remove-daysoff" title="Remove days off"><i class="fa fa-fw fa-trash"></i></div>
                    </li>
                  {{/each}}
                </ul>
              {{else}}
                None
              {{/with}}

            </div>
          </div>
          <div class="btn btn-default btn-sm set-simple-daily-availability">Simple</div>
        </div>
      {{/if}}
    </td>
  </tr>
</template>

<template name="delivery_planner_task_pane_project_tab_burndown_chart">
  <div id="burndown-chart"></div>

  {{#if showBaselineSetting}}
    <div class="dp-project-setting">
      <div class="setting-label">Baseline projection <span class="baseline-projection-more-info" title="The Baseline Projection 'Freezes' the Current Projection as a reference point for future comparisons."><i class="fa fa-question-circle fa-fw"></i></span></div>

      <div class="setting-controller">
        <div class="btn btn-default btn-xs {{#if hasBaselineProjection}}dp-remove-baseline{{else}}dp-save-baseline{{/if}}">{{#if hasBaselineProjection}}Remove{{else}}Save{{/if}}</div>
      </div>

      <div class="clearfix"></div>
    </div>
  {{/if}}
</template>

<template name="delivery_planner_task_pane_assign_tab">
  <section>
    {{#with assignedProjects}}
      <h2>Assigned to the following projects</h2>

      {{#each this}}
        <div class="dp-task-context">
          <div class="dp-task-context-delete" title="Unassign project">
            <i class="fa fa-trash-o" aria-hidden="true"></i>
          </div>
          <div class="dp-context-item" style="padding-left: 0px" path="/QxZD3RdZhiJmiaBqm/">
            <span class="dp-task-seq-id grid-tree-control-task-id label">
              <span class="dp-task-seq-id-number">
                {{seqId}}
              </span>
            </span> {{#if assignedProjectIsArchived}}<i class="fa fa-archive" aria-hidden="true" title="Closed project"></i>{{/if}} {{title}}
          </div>
        </div>
      {{/each}}
    {{/with}}
  </section>

  <section class="assign-to-project-section">
    <h2>Assign to projects</h2>

    {{#with availableProjects}}
      <div class="project-add-wrapper">
        <div class="form-inline">
          <div class="form-group">
            <select class="dropdown-menu-lite dropdown-menu-lite-users project-select">
              {{#each this}}
                <option value="{{_id}}">#{{seqId}}: {{title}}</option>
              {{/each}}
            </select>
          </div>
          <div type="button" class="btn btn-default add-project-btn">Add</div>
        </div>
      </div>
    {{else}}
      <div class="no-projects-available">
        <p>No projects available for assigning.</p>
      </div>

    {{/with}}
  </section>
</template>

<template name="task_pane_justdo_files_task_pane_section_section">
  {{>justdo_files_gallery}}

  {{> justdo_files_uploader}}
</template>

<template name="justdo_files_gallery">
  <div class="justdo-files-gallery">
    {{#each files}}
      {{#with task=.. file=.}}
        <div class="file">
          <div class="type-logo {{typeClass}}"></div>

          <div class="content">
            <div class="title">
              {{#if renaming}}
                <input type="text" name="title" value="{{file.name}}">
              {{else}}
                <a href="{{fileURL file}}" target="_blank" class="file-download-link">{{file.name}}</a>
              {{/if}}
            </div>
            <div class="metadata">
              <span class="date" title="{{userDateFormat file.meta.upload_date}}">{{userDateFormat file.meta.upload_date false}}</span>
              <span class="dot"></span>
              <span class="size">{{size}}</span>
              <span class="dot"></span>
              <span class="mimetype">{{file.type}}</span>
            </div>
          </div>

          {{#if isImage}}
            <div class="image-preview file-download-link loading {{tempPlaceHolder}}"></div>
          {{/if}}

          {{#if deletion}}
            <div class="msg">
              <div class="loader">
                <div class="double-bounce1"></div>
                <div class="double-bounce2"></div>
              </div>
              <div class="msg-content">
                Remove this file?
                <a href="" class="msg-ok">Ok</a>
                <a href="" class="msg-cancel">Cancel</a>
              </div>
              <!-- <p>Remove this file?</p>
                -->
            </div>
          {{/if}}

          {{#if renaming}}
            <div class="actions-rename">
              <a href="" class="file-rename-done"></a>
              <a href="" class="file-rename-cancel"></a>
            </div>
          {{/if}}

          <div class="actions">
            <a href="" class="file-rename-link"></a>
            <a href="" class="file-remove-link"></a>
          </div>

        </div>
      {{/with}}
    {{/each}}
  </div>
</template>

<template name="justdo_files_uploader">
  <div class="drop-pane {{isHovering}} {{getState}} {{#if noFiles}}no-files{{/if}}">
    <label for="file-input" class="custom-file-input">
      <div>
        <div class="drop-pane-logo"></div>
        {{#if hasPreviousUploadResult}}
          <div class="prev-upload-result">
            {{#if $gt numSuccessfulUploads 0}}
              <div class="upload-success-msg">{{numSuccessfulUploads}} file(s) uploaded successfully.</div>
            {{/if}}
            {{#if $gt numFailedUploads 0}}
              {{numFailedUploads}} file(s) failed to upload:
              {{#each getFailedUploads}}
                <div class="upload-failed-entry" data-toggle="tooltip" data-placement="bottom" title="{{this.err_msg}}">
                  <span>{{this.file.name}}</span>
                  <i class="fa fa-exclamation-circle"></i>
                </div>
              {{/each}}
            {{/if}}
          </div>
        {{/if}}
        
        <span class="upload-msg">
          {{#if $eq getState "ready"}}
            {{#if hasPreviousUploadResult}}
              Drop or click to upload other file(s)
            {{else}}
              Drop file(s) here or click to upload
            {{/if}}
          {{else}}
            <div class="upload-process-msg">{{getUploadProcessMsg}}</div>
            Drop or click to upload more file(s)
          {{/if}}
        </span>
  
        <span class="drop-to-upload-msg">
          Drop to upload
        </span>
  
      </div>
    </label>
    <input id="file-input" type="file" multiple />
  </div>
</template>
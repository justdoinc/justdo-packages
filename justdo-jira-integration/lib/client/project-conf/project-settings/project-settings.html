<template name="justdo_jira_integration_project_setting">
  <div class="jira-oauth-container">
    <h5>Connection</h5>
    {{#if oAuthLoginLink}}
      <a class="jira-login-link" href="{{oAuthLoginLink}}" target="_blank">Connect with JIRA</a>
    {{else}}
      <span>Loading...</span>
    {{/if}}

    {{#with serverInfo}}
      <div>
        Connected to Jira instance <a href="{{url}}" target="_blank">{{name}}</a>
      </div>
    {{/with}}
  </div>

  {{#with serverInfo}}
    <div class="jira-field-map-container">
      <h5>Fields Mapping</h5>

      <span>We have setup the following fields for you. They will apply to all mounted Jira projects and cannot be changed.</span><br>

      <div class="jira-field-pair">
        <span class="field-name"><b>JustDo Field</b></span><span class="arrow"></span><span class="field-name"><b>Jira Field</b></span>
      </div>

      {{#each hardcodedFieldsMap}}
        <div class="jira-field-pair">
          <span class="field-name">{{justdo_field_name}}</span><span class="arrow">↔</span><span class="field-name">{{jira_field_name}}</span>
        </div>
      {{/each}}

      <br>Configure extra field mapping<br>

      {{#if selectedJiraProjectId}}
        <div class="jira-field-map-rows-wrapper">
          {{#each customFieldsMap}}
            {{> justdo_jira_integration_field_map_option_pair templateDataForChildTemplate}}
          {{else}}
            {{> justdo_jira_integration_field_map_option_pair templateDataForChildTemplate}}
          {{/each}}
        </div>

        <div class="jira-field-map-add-row">+</div>
        <a href="#" class="set-custom-field-pair">Apply</a>

      {{else}}
        {{#each mountedJiraProjectsUnderActiveJustdo}}
          <a href="#" class="configure-jira-project-field-mapping" data-id="{{jira_project_id}}">{{jira_project_key}}</a><br>
        {{/each}}
      {{/if}}

    </div>
  {{/with}}
</template>

<template name="justdo_jira_integration_field_map_option_pair">
  {{#with fieldsAvaibleForUserMapping}}
    <div class="custom-jira-field-pair" data-field_pair_id="{{fieldPairId}}">

      <select class="justdo-field-select" {{isSelectDisabled}} {{isSelectOptionChosen}}>
        <option value="empty" disabled selected>---JustDo Field---</option>
        {{#if isSelectOptionChosen}}
          <option value="new_custom_select" data-field_type="option" selected>(New custom field)</option>
        {{else}}
          {{#each justdo_fields}}
            <option value="{{field_id}}" data-field_type="{{field_type}}" {{isFieldSelected}}>{{field_name}}({{ucFirst field_type}})</option>
          {{/each}}
        {{/if}}
      </select>

      <span class="arrow">↔</span>

      <select class="jira-field-select" {{isSelectDisabled}}>
        <option value="empty" disabled selected>---Jira Field---</option>
        {{#each jira_fields}}
          <option value="{{field_id}}" data-field_type="{{field_type}}" {{isFieldSelected}}>{{field_name}}({{ucFirst field_type}})</option>
        {{/each}}
      </select>

      {{#if isSelectDisabled}}
        <a href="#" class="remove-custom-field-pair">X</a>
      {{/if}}
    </div>
  {{/with}}
</template>

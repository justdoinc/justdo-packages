<template name="justdo_jira_integration_project_setting">
  <div class="jira-oauth-wrapper">
    <h5>Connection</h5>
    {{#if oAuthLoginLink}}
      <a class="jira-login-link" href="{{oAuthLoginLink}}" target="_blank">Connect with JIRA</a>
    {{else}}
      <span>Loading...</span>
    {{/if}}

    {{#with serverInfo}}
      <div>
        Connected to Jira instance <a href="{{url}}" target="_blank">{{name}}</a>
      </div>
    {{/with}}
  </div>

  {{#with serverInfo}}
    <div class="jira-field-map-wrapper">
      <h5>Fields Mapping</h5>

      <span>We have setup the following fields for you. They will apply to all mounted Jira projects and cannot be changed.</span><br>

      <div class="jira-field-pair">
        <span class="jira-field"><b>JustDo Field</b></span><span class="jira-field"></span><span class="jira-field"><b>Jira Field</b></span>
      </div>
      {{#each hardcodedFieldsMap}}
        <div class="jira-field-pair">
          <span class="jira-field">{{justdo_field}}</span><span class="jira-field">→</span><span class="jira-field">{{jira_field}}</span>
        </div>
      {{/each}}

      <br>Configure extra field mapping<br>

      {{#if selectedJiraProjectId}}
        {{#each customFieldsMap}}
          {{> justdo_jira_integration_field_map_option_pair templateDataForChildTemplate}}
        {{/each}}

        {{> justdo_jira_integration_field_map_option_pair templateDataForChildTemplate}}

        <a href="#" class="set-custom-field-pair">Apply</a>
      {{else}}
        {{#each mountedJiraProjectsUnderActiveJustdo}}
          <a href="#" class="configure-jira-project-field-mapping" data-id="{{jira_project_id}}">{{jira_project_key}}</a><br>
        {{/each}}
      {{/if}}

    </div>
  {{/with}}
</template>

<template name="justdo_jira_integration_field_map_option_pair">
  {{#with fieldsAvaibleForUserMapping}}
    <div class="custom-jira-field-pair">
      <select>
        <option disabled selected>---JustDo Field---</option>
        {{#each justdo_fields}}
          {{#if selected}}
            <option value="{{field_id}}::{{field_type}}" selected>{{field_name}}({{ucFirst field_type}})</option>
          {{else}}
            <option value="{{field_id}}::{{field_type}}">{{field_name}}({{ucFirst field_type}})</option>
          {{/if}}
        {{/each}}
      </select>
      <span class="jira-field">→</span>
      <select>
        <option disabled selected>---Jira Field---</option>
        {{#each jira_fields}}
          {{#if selected}}
            <option value="{{field_id}}::{{field_type}}" selected>{{field_name}}({{ucFirst field_type}})</option>
          {{else}}
            <option value="{{field_id}}::{{field_type}}">{{field_name}}({{ucFirst field_type}})</option>
          {{/if}}
        {{/each}}
      </select>
    </div>
  {{/with}}
</template>

<template name="project_pane_kanban">
  <div class="kanban-toolbar">
    <div class="kanban-toolbar-operations-left">
      <!-- Kanban Task Selector -->
      <div class="kanban-task-selector dropdown">
        <button class="btn btn-light btn-sm border" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
          <svg class="jd-icon"><use xlink:href="/layout/icons-feather-sprite.svg#zoom-in"/></svg>
        </button>
        <ul class="dropdown-menu jd-p-075 shadow-lg border-0">
          <li class="dropdown-header text-muted mt-1">Selected task</li>
          {{#if selectedTask}}
            {{#with selectedTask}}
              <li>
                <a href="#" class="dropdown-item js-kanban-selected-task">
                  {{taskCommonName}}
                </a>
              </li>
            {{/with}}
          {{else}}
              <li><a href="#" class="dropdown-item disable-element text-muted">No selected task</a></li>
          {{/if}}
          {{#if projects}}
            <li class="dropdown-header text-muted mt-2">Projects</li>
          {{/if}}
          {{#each projects}}
            <li><a href="#" class="dropdown-item js-kanban-selected-task">{{title}}</a></li>
          {{/each}}
        </ul>
      </div>
      <div class="{{#unless activeTask}}disable-element{{/unless}} d-flex align-items-center">
        <!-- Kanban State Selector -->
        <div class="kanban-state-selector dropdown ml-2">
          <button class="btn btn-light btn-sm border" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
            State
          </button>
          <ul class="dropdown-menu jd-p-075 shadow-lg border-0">
            <li><a href="#" class="dropdown-item js-kanban-state-item-default">State</a></li>
            {{#each customFields}}
              <li><a href="#" class="dropdown-item js-kanban-state-item">{{label}}</a></li>
            {{/each}}
          </ul>
        </div>
        <div class="divider"></div>
        <!-- Kanban User Selector -->
        <div class="kanban-member-selector {{#if activeMember}}active-member{{/if}} dropdown mr-1">
          {{#if activeMember}}
            <img class="kanban-filter-member-avatar" src="{{memberAvatar activeMember}}" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">
            <svg class="jd-icon kanban-clear-member-filter"><use xlink:href="/layout/icons-feather-sprite.svg#x"/></svg>
          {{else}}
            <svg class="jd-icon" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true"><use xlink:href="/layout/icons-feather-sprite.svg#filter"/></svg>
          {{/if}}
          <ul class="dropdown-menu jd-p-075 shadow-lg border-0">
            <input class="kanban-member-selector-search form-control form-control-sm mb-2 bg-light border-0" type="text" placeholder="Search members" name="" value="">
            {{#each members}}
              <li>
                <a href="#" class="dropdown-item kanban-filter-member-item {{#if thisIsActiveMember this}}text-primary{{/if}}">
                  <img class="kanban-member-avatar" src="{{memberAvatar this}}"> {{memberName this}}
                </a>
              </li>
            {{/each}}
          </ul>
        </div>
        <!-- Kanban Sort Selector -->
        <div class="kanban-sort-selector dropdown sort-by-{{sortBy}}">
          <svg class="jd-icon" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true"><use xlink:href="/layout/icons-feather-sprite.svg#jd-sort"/></svg>
          <ul class="dropdown-menu jd-p-075 shadow-lg border-0">
            <li>
              <a href="#" class="dropdown-item kanban-sort-by-date">
                By Date
                {{#if sortByReverse}}
                  <svg class="jd-icon"><use xlink:href="/layout/icons-feather-sprite.svg#arrow-down"/></svg>
                {{else}}
                  <svg class="jd-icon"><use xlink:href="/layout/icons-feather-sprite.svg#arrow-up"/></svg>
                {{/if}}
              </a>
            </li>
            <li>
              <a href="#" class="dropdown-item kanban-sort-by-priority">
                By Priority
                {{#if sortByReverse}}
                  <svg class="jd-icon"><use xlink:href="/layout/icons-feather-sprite.svg#arrow-up"/></svg>
                {{else}}
                  <svg class="jd-icon"><use xlink:href="/layout/icons-feather-sprite.svg#arrow-down"/></svg>
                {{/if}}
              </a>
            </li>
            <li>
              <a href="#" class="dropdown-item kanban-sort-by-due-date">
                By Due Date
                {{#if sortByReverse}}
                  <svg class="jd-icon"><use xlink:href="/layout/icons-feather-sprite.svg#arrow-up"/></svg>
                {{else}}
                  <svg class="jd-icon"><use xlink:href="/layout/icons-feather-sprite.svg#arrow-down"/></svg>
                {{/if}}
              </a>
            </li>
          </ul>
        </div>
      </div>
    </div>
    {{#if activeTask}}
      <div class="kanban-active-task-title">
        {{#with activeTask}}
          {{taskCommonName}}
        {{/with}}
      </div>
    {{/if}}
    <div class="kanban-toolbar-operations-right"></div>
  </div>

  <div class="kanban-wrapper clearfix">
    {{#if activeTask}}
    <div class="kanban-wrapper-container">
      <div class="kanban-boards">

        {{#each boards}}
          {{#if visible}}
            <div class="kanban-board">
              <div class="kanban-board-header">
                <div class="kanban-board-title">
                  <div class="kanban-board-count {{markCrossedLimit option_id}}">{{boardCount option_id}}</div>
                  {{label}}
                </div>
                <div class="kanban-board-control">
                  <svg class="jd-icon kanban-board-task-add-button"><use xlink:href="/layout/icons-feather-sprite.svg#plus"/></svg>
                  <div class="kanban-board-dropdown dropdown">
                    <svg class="jd-icon kanban-board-dropdown-icon" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true"><use xlink:href="/layout/icons-feather-sprite.svg#more-vertical"/></svg>
                    <ul class="dropdown-menu p-2 shadow-lg border-0">
                      <li class="dropdown-item kanban-board-edit" data-toggle="modal" data-target="#kanban-board-settings">
                        <svg class="jd-icon"><use xlink:href="/layout/icons-feather-sprite.svg#edit-3"/></svg>Edit Column
                      </li>
                      <li class="dropdown-item kanban-board-hide">
                        <svg class="jd-icon"><use xlink:href="/layout/icons-feather-sprite.svg#eye-off"/></svg>Hide Column
                      </li>
                    </ul>
                  </div>
                </div>
              </div>
              <div class="kanban-board-content">
                {{#each tasks option_id}}
                  <div class="kanban-task">
                    <div class="kanban-task-id">{{seqId}}</div>
                    <div class="kanban-task-priority" style="background-color: {{taskPriorityColor priority}}"></div>
                    <img class="kanban-task-user" src="{{memberAvatar owner_id}}">
                    <div class="kanban-task-title">{{title}}</div>
                    <div class="kanban-task-control dropdown">
                      <svg class="jd-icon kanban-task-control-icon" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true"><use xlink:href="/layout/icons-feather-sprite.svg#more-vertical"/></svg>
                      <ul class="dropdown-menu p-2 shadow-lg border-0">
                        <li class="dropdown-item kanban-task-remove">
                          <svg class="jd-icon"><use xlink:href="/layout/icons-feather-sprite.svg#trash-2"/></svg>Remove Task
                        </li>
                      </ul>
                    </div>
                    {{#if due_date}}
                      <div class="kanban-task-tooltip">Due Date: {{due_date}}</div>
                    {{/if}}
                  </div>
                {{/each}}
                <div class="kanban-task-add">
                  <input class="form-control kanban-task-add-input" type="text" placeholder="Add new Task">
                </div>
              </div>
            </div>
          {{/if}}
        {{/each}}
        <div class="kanban-board-add text-muted" data-toggle="modal" data-target="#kanban-add-board">
          <div class="kanban-board-add-content"><svg class="jd-icon"><use xlink:href="/layout/icons-feather-sprite.svg#plus"/></svg></div>
        </div>
      </div>
    </div>
    {{else}}
    <div class="kanban-start-message">
      Select a task on the main view to present a Kanban board
    </div>
    {{/if}}
  </div>

  <!-- Board Settings -->
  <div class="modal fade" id="kanban-board-settings" data-backdrop="false" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog modal-sm" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h6 class="modal-title">Settings</h6>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <div class="font-weight-bold text-body text-uppercase mb-2">Column limit</div>
          <input type="text" class="kanban-board-limit-input form-control form-control-sm">
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
          <button type="button" class="btn btn-primary kanban-limit-save">Save</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Add Board -->
  <div class="modal fade" id="kanban-add-board" data-backdrop="false" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog modal-sm" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h6 class="modal-title">Add Column</h6>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          {{#each boards}}
            <button type="button" class="kanban-board-add-item btn btn-primary {{#unless visible}}hidden{{/unless}} btn-sm text-left font-weight-bold">{{label}}</button>
          {{/each}}
        </div>
      </div>
    </div>
  </div>

</template>

<template name="task_pane_item_details_members_editor">
  <div class="members-editor-search d-flex align-items-center">
    <input type="text" class="members-search-input" value="" placeholder="Find member">
  </div>
  <div class="members-section {{#if isRemovingSelf}}remove-self{{/if}}">
    {{#each sections}}
      {{> task_pane_item_details_members_editor_section}}
    {{/each}}
  </div>
  <div class="checkbox">
    <label>
      <input class="cascade-action-checkbox mr-2" type="checkbox" checked="{{isChecked cascade true}}"> Apply changes to all child-tasks.
    </label>
  </div>
  <div class="members-section-info">
    {{#if display_notes_section}}
      <div class="notes">
        <ul>
          {{#each notes}}
            <li>{{this}}</li>
          {{/each}}
        </ul>
        <svg class="jd-icon notes-close"><use xlink:href="/layout/icons-feather-sprite.svg#x"></use></svg>
      </div>
    {{/if}}
    {{#if displayRecentBatchedOps}}
      <div class="recent-batched-info show-less">
        {{> task_pane_item_details_members_editor_recent_batched_ops}}
      </div>
    {{/if}}
  </div>
</template>

<template name="task_pane_item_details_members_editor_recent_batched_ops">
  {{#each recentBatchedOps}}
    <div class="recent-batched-item">
      <div class="recent-batched-msg-wrapper">
        <div class="recent-batched-msg">
          {{opsMessage}}
          {{#if pendingOrInProgress}}
            {{processedPercent}}%
          {{/if}}
        </div>
        {{#if pendingOrInProgress}}
          <span class="terminate">terminate</span>
        {{/if}}
      </div>
    </div>
  {{/each}}
  {{#if showViewToggle}}
    <div class="recent-batched-view-toggle show-all">
      <div class="toggle-title">show all updates</div><div class="toggle-count">{{recentBatchedOpsCount}}</div>
    </div>
    <svg class="jd-icon recent-batched-view-toggle show-less"><use xlink:href="/layout/icons-feather-sprite.svg#x"></use></svg>
  {{/if}}
</template>

<template name="task_pane_item_details_members_editor_section">
  <div class="members-list-container members-list-{{action_id}}-container">
    <div class="section-caption">
      <div class="d-flex">
        {{caption}}
        <div class="select-all text-primary">All</div>
        <div class="select-none text-primary">None</div>
      </div>
      {{#if showInviteMembersSection}}
        <div class="invite-new-member-dropdown dropdown">
          <div class="invite-new-member-toggle text-primary" data-toggle="dropdown" aria-expanded="true">
            <svg class="jd-icon"><use xlink:href="/layout/icons-feather-sprite.svg#plus"></use></svg>
            New member
          </div>
          <div class="dropdown-menu jd-p-075 animate slideIn shadow-lg border-0">
            <div class="invite-members-section">
              <div class="d-flex align-items-center">
                <input class="form-control form-control-sm mr-2" type="text" placeholder="{{#if isAddAsGuest}}Guest's{{else}}Member's{{/if}} Email">
                <button class="btn btn-primary btn-sm" type="button" name="button">Invite</button>
              </div>
              {{> add_as_guest_toggle controller=add_as_guest_toggle_controller}}
            </div>
          </div>
        </div>
      {{/if}}
    </div>
    {{#if $not action_users_empty}}{{!-- If there are members for this action --}}
      <div class="members-editor-dialog-{{action_id}}-section members-list">
        <div class="action-users">
          {{#each action_users_filtered}}
            {{> task_pane_item_details_members_editor_user_btn}}
          {{else}}
            <div class="no-results">No results found</div>
          {{/each}}
        </div>
      </div>
    {{else}}
      <div class="members-editor-dialog-{{action_id}}-section members-list members-list-no-members">
        <div class="no-members">
          {{no_members_msg}}<br>
        </div>
      </div>
    {{/if}}
  </div>
</template>

<template name="task_pane_item_details_members_editor_user_btn">
  <div class="user-btn {{#if proceed.get}}proceed{{else}}dont-proceed{{/if}} {{#if disabledReason}}disabled{{/if}}"
      user-id="{{_id}}" data-toggle="tooltip" data-placement="top" title="{{disabledReason}}">
    <div class="d-flex align-items-center flex-grow-1 pr-3">
      {{> gtpl_user_profile_pic}}
      <div class="display-name">
        {{> display_name_with_graphic_unverified_warning}}
        {{showYouIfIsOwner}}
      </div>
    </div>
    {{#if proceed.get}}
      <svg class="jd-icon user-check"><use xlink:href="/layout/icons-feather-sprite.svg#check"/></svg>
    {{else}}
      <svg class="jd-icon user-plus"><use xlink:href="/layout/icons-feather-sprite.svg#plus"/></svg>
      <svg class="jd-icon user-x"><use xlink:href="/layout/icons-feather-sprite.svg#x"/></svg>
    {{/if}}
  </div>
</template>

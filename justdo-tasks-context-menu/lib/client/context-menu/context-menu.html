<template name="tasks_context_menu">
  <ul class="dropdown-menu p-2 shadow-lg border-0">
    {{#each section in getMainSections}}
      {{#if isSectionHasItems section}}
        {{> tasks_context_section section=section}}
      {{/if}}
    {{/each}}
    <li class="context-section-label-container label-less-section">
      <hr class="my-2">
    </li>
    <li class="more-info-items">
      <div>
        <div>Updated {{moFromNow controller.getContextItemObj.updatedAt}}</div>
        <div class="text-secondary">by {{displayName updatedByOrCreatedBy}}</div>
      </div>
    </li>
  </ul>
</template>

<template name="tasks_context_section">
  {{#with section}}
    <li class="context-section-label-container {{#unless label}}label-less-section{{/unless}}">
      <hr class="my-2" />
      {{#if label}}
        <div class="context-section-label">
          {{> tasks_context_menu_label}}
        </div>
      {{/if}}
    </li>
    {{#if display_item_filter_ui}}
      <div class="section-filter-container">
        <input type="text" class="section-filter form-control form-control-sm" placeholder="{{display_item_filter_ui_placeholder}}">
        <svg class="jd-icon text-secondary search-icon"><use xlink:href="/layout/icons-feather-sprite.svg#search"></use></svg>
      </div>
    {{/if}}
  {{/with}}
  {{#let current_section_id=section.id}}
    {{#each section.reactive_items_list.getList}}
      <li class="dropdown-item context-action-item {{#if hasNestedSections}} context-nested-section-item{{/if}}">
        {{> tasks_context_menu_label}}

        {{#if hasNestedSections}}
          <ul class="dropdown-menu p-2 shadow-lg border-0 nested-dropdown-menu nested-dropdown-menu-{{id}}">
            {{#each getNestedSections current_section_id id}}
              {{> tasks_context_section section=this}}
            {{/each}}
          </ul>

          <div class="context-nested-section-item-caret">
            <i class="fa fa-caret-right"></i>
          </div>
        {{/if}}
      </li>
    {{/each}}
  {{/let}}
</template>

<template name="tasks_context_menu_label">
  {{> tasks_context_menu_icon}} {{> tasks_context_menu_label_content}}
</template>

<template name="tasks_context_menu_icon">
  {{#if $eq icon_type "feather"}}
    <svg class="jd-icon jd-icon-context-action text-secondary"><use xlink:href="/layout/icons-feather-sprite.svg#{{getIconValValue}}"/></svg>
  {{else if $eq icon_type "none"}}
    <div class="empty-icon"></div>
  {{/if}}
</template>

<template name="tasks_context_menu_label_content">
  {{getLabelValue}} {{#if label_addendum_template}}{{> Template.dynamic template=label_addendum_template data=getLabelAddendumDataContext}}{{/if}}
</template>
<template name="members_dropdown_menu">
  <div class="members-dropdown-menu dropdown-menu dropdown-menu-right p-3 animate slideIn shadow-lg border-0">
    <div class="members-search-wrapper d-flex align-items-center">
      <input type="text" class="members-search-input form-control form-control-sm" placeholder="Members">
      <svg class="jd-icon text-secondary"><use xlink:href="/layout/icons-feather-sprite.svg#search"/></svg>
    </div>

    <div class="alerts-container"></div>

    <ul class="project-members-container">
      {{#if isEmptyResults getCurrentMembersFilter}}
        <li class="no-results text-center my-3 text-muted">No results found</li>
      {{else}}
        {{#with project_enrolled_admins_sorted_by_first_name getCurrentMembersFilter}}
          <li class="dropdown-header text-muted text-uppercase mt-1 px-0 pb-2">Admins</li>

          {{#each this}}
            {{> admin_member_item}}
          {{/each}}
        {{/with}}

        {{#with project_enrolled_regular_members_sorted_by_first_name getCurrentMembersFilter}}
          <li class="dropdown-header text-muted text-uppercase mt-3 px-0 pb-2">Members</li>

          {{#each this}}
            {{> regular_member_item}}
          {{/each}}
        {{/with}}

        {{#with project_enrolled_guests_sorted_by_first_name getCurrentMembersFilter}}
          <li class="dropdown-header text-muted text-uppercase mt-3 px-0 pb-2">Guests</li>

          {{#each this}}
            {{> guest_member_item}}
          {{/each}}
        {{/with}}

        {{#with project_non_enrolled_members_sorted_by_first_name getCurrentMembersFilter}}
          <li class="dropdown-header text-muted text-uppercase mt-3 px-0 pb-2">Members Awaiting Registration</li>

          {{#each this}}
            {{> enrollment_pending_member}}
          {{/each}}
        {{/with}}

        {{#with project_non_enrolled_guests_sorted_by_first_name getCurrentMembersFilter}}
          <li class="dropdown-header text-muted text-uppercase mt-3 px-0 pb-2">Guests Awaiting Registration</li>

          {{#each this}}
            {{> enrollment_pending_member}}
          {{/each}}
        {{/with}}
      {{/if}}
    </ul>
    {{#if is_project_admin}}
      <div class="add-project-members">
        <div class="dropdown-header text-muted text-uppercase px-0 pb-2">
          {{> add_as_guest_toggle controller=add_as_guest_toggle_controller}}
          Invite New Members
        </div>
        <div class="add-members-comp d-flex align-items-center">
          <input type="text" class="form-control form-control-sm mr-2" placeholder="{{#if isAddAsGuest}}Guest{{else}}Member{{/if}}'s Email">
          <button class="btn btn-primary btn-sm font-weight-bold text-uppercase" type="button">Invite</button>
        </div>
      </div>
    {{/if}}
  </div>
</template>

<template name="admin_member_item">
  <li class="member-item admin-item d-flex align-items-center justify-content-between mb-2" user-id="{{_id}}">
    <div class="d-flex align-items-center">
      {{> gtpl_user_profile_pic}} <div class="display-name mx-2">{{> display_name_with_graphic_unverified_warning}}</div>
    </div>
    <div class="d-flex align-items-center">
      {{#if is_project_admin}}
        <span title="Revoke {{displayName}}'s admin rights">
          <svg class="jd-icon text-secondary op-button downgrade-admin"><use xlink:href="/layout/icons-feather-sprite.svg#star"/><desc>[long description]</desc></svg>
        </span>
      {{/if}}

      {{#if allow_member_remove user_id}}
        <span title="Remove {{displayName}} from this JustDo">
          <svg class="jd-icon text-secondary op-button remove"><use xlink:href="/layout/icons-feather-sprite.svg#x"/></svg>
        </span>
      {{/if}}
    </div>
  </li>
</template>

<template name="regular_member_item">
  <li class="member-item regular-member-item d-flex align-items-center justify-content-between mb-2" user-id="{{_id}}">
    <div class="d-flex align-items-center">
      {{> gtpl_user_profile_pic}} <div class="display-name mx-2">{{> display_name_with_graphic_unverified_warning}}</div>
    </div>
    <div class="d-flex align-items-center">
      {{#if is_project_admin}}
        <span title="Make {{displayName}} an admin">
          <svg class="jd-icon text-secondary op-button upgrade-admin"><use xlink:href="/layout/icons-feather-sprite.svg#star"/></svg>
        </span>

        <span title="Make {{displayName}} a guest">
          <svg class="jd-icon text-secondary op-button make-guest"><use xlink:href="/layout/icons-feather-sprite.svg#chevron-down"/></svg>
        </span>
      {{/if}}

      {{#if allow_member_remove user_id}}
        <span title="Remove {{displayName}} from this JustDo">
          <svg class="jd-icon text-secondary op-button remove"><use xlink:href="/layout/icons-feather-sprite.svg#x"/></svg>
        </span>
      {{/if}}
    </div>
  </li>
</template>

<template name="guest_member_item">
  <li class="member-item regular-member-item d-flex align-items-center justify-content-between mb-2" user-id="{{_id}}">
    <div class="d-flex align-items-center">
      {{> gtpl_user_profile_pic}} <div class="display-name mx-2">{{> display_name_with_graphic_unverified_warning}}</div>
    </div>
    <div class="d-flex align-items-center">
      {{#if is_project_admin}}
        <span title="Make {{displayName}} a member">
          <svg class="jd-icon text-secondary op-button upgrade-guest"><use xlink:href="/layout/icons-feather-sprite.svg#chevron-up"/></svg>
        </span>
      {{/if}}

      {{#if allow_member_remove user_id}}
        <span title="Remove {{displayName}} from this JustDo">
          <svg class="jd-icon text-secondary op-button remove"><use xlink:href="/layout/icons-feather-sprite.svg#x"/></svg>
        </span>
      {{/if}}
    </div>
  </li>
</template>

<template name="enrollment_pending_member">
  <li class="member-item enrollment-pending-member-item d-flex align-items-center justify-content-between mb-2" user-id="{{_id}}">
    <div class="d-flex align-items-center">
      {{> gtpl_user_profile_pic}} <div class="display-name mx-2" title="{{userEmail this}}">{{displayName}}</div>
    </div>

    <div class="d-flex align-items-center">
      {{#if allow_member_edit_enrollment_pending_member user_id}}
        <span title="Edit {{displayName}}">
          <svg class="jd-icon text-secondary op-button edit-enrolled"><use xlink:href="/layout/icons-feather-sprite.svg#edit-3"/></svg>
        </span>
      {{/if}}

      {{#unless is_guest}}
        {{#if is_project_admin}}
          <span title="{{#if is_admin}}Revoke {{displayName}}'s admin rights{{else}}Make {{displayName}} a JustDo admin upon registration{{/if}}">
            <svg class="jd-icon text-secondary op-button {{#if is_admin}}downgrade-admin{{else}}upgrade-admin{{/if}}"><use xlink:href="/layout/icons-feather-sprite.svg#star"/></svg>
          </span>
        {{/if}}
      {{/unless}}

      {{#if allow_member_remove user_id}}
        <span title="Remove {{displayName}} from this JustDo">
          <svg class="jd-icon text-secondary op-button remove"><use xlink:href="/layout/icons-feather-sprite.svg#x"/></svg>
        </span>
      {{/if}}
    </div>
  </li>
</template>

<template name="members_dropdown_menu">
  <div class="members-dropdown-wrapper {{#if inviteMode}}invite-mode{{/if}}">
    <div class="members-dropdown-list {{#if selectMode}}selected-mode{{/if}}">
      <div class="members-search-wrapper d-flex align-items-center">
        <input type="text" class="members-search-input form-control form-control-sm" placeholder="Members">
        {{#if is_project_admin}}
          <div class="member-invite-dropdown animate {{#if isEmptyResults getCurrentMembersFilter}}slideIn{{/if}}">
            <div class="member-invite-btn member-invite-btn-js">
              <svg class="jd-icon"><use xlink:href="/layout/icons-feather-sprite.svg#user-plus"></use></svg>
              Invite <span>{{getCurrentMembersFilter}}</span>
            </div>
          </div>
        {{/if}}
      </div>

      <div class="alerts-container"></div>

      <ul class="project-members-container">
        {{#if isEmptyResults getCurrentMembersFilter}}
          <li class="no-results">No results found</li>
        {{else}}
          {{#with project_enrolled_admins_sorted_by_first_name getCurrentMembersFilter}}
            {{#each this}}
              <div class="member-item-wrapper {{#if memberSelected}}selected{{/if}}">
                {{> admin_member_item}}
              </div>
            {{/each}}
          {{/with}}

          {{#with project_enrolled_regular_members_sorted_by_first_name getCurrentMembersFilter}}
            {{#each this}}
              <div class="member-item-wrapper {{#if memberSelected}}selected{{/if}}">
                {{> regular_member_item}}
              </div>
            {{/each}}
          {{/with}}

          {{#with project_enrolled_guests_sorted_by_first_name getCurrentMembersFilter}}
            {{#each this}}
              <div class="member-item-wrapper {{#if memberSelected}}selected{{/if}}">
                {{> guest_member_item}}
              </div>
            {{/each}}
          {{/with}}

          {{#with project_non_enrolled_members_sorted_by_first_name getCurrentMembersFilter}}
            <li class="members-dropdown-header">Invited members</li>
            {{#each this}}
              <div class="member-item-wrapper {{#if memberSelected}}selected{{/if}}">
                {{> enrollment_pending_member}}
              </div>
            {{/each}}
          {{/with}}

          {{#with project_non_enrolled_guests_sorted_by_first_name getCurrentMembersFilter}}
            {{#each this}}
              <div class="member-item-wrapper {{#if memberSelected}}selected{{/if}}">
                {{> enrollment_pending_member}}
              </div>
            {{/each}}
          {{/with}}
        {{/if}}
      </ul>
      {{#if is_project_admin}}
        <div class="add-project-members">
          {{#if selectMode}}
            <button class="btn btn-default btn-sm cancel-select-mode" type="button">Cancel</button>
            <button class="btn btn-primary btn-sm remove-selected {{#if allowRemoveSelected}}active{{/if}}" type="button">Remove {{#if allowRemoveSelected}}({{selectedMembersCount}}){{/if}}</button>
          {{else}}
            <button class="btn btn-primary btn-sm show-add-members-dialog member-invite-btn-js" type="button">Invite</button>
          {{/if}}
        </div>
      {{/if}}
    </div>
    {{#if is_project_admin}}
      {{> members_dropdown_invite}}
    {{/if}}
  </div>

</template>

<template name="admin_member_item">
  <li class="member-item admin-item {{#if is_current_user user_id}}current-user{{/if}}" user-id="{{_id}}">
    <div class="d-flex align-items-center">
      <div class="select-icon"></div>
      {{> gtpl_user_profile_pic}}
      <div class="display-name mx-2">{{> display_name_with_graphic_unverified_warning}}</div>
    </div>
    {{#if allow_show_member_dropdown_settings user_id}}
      <div class="member-settings-dropdown">
        <div class="member-role-label text-primary">Admin</div>
        <svg class="jd-icon text-secondary member-settings-dropdown-btn"><use xlink:href="/layout/icons-feather-sprite.svg#more-vertical"></use></svg>
        <div class="member-settings-dropdown-menu animate slideIn">
          {{#if is_project_admin}}
            <div class="dropdown-item downgrade-admin">
              <svg class="jd-icon-dropdown text-dark"><use xlink:href="/layout/icons-feather-sprite.svg#star"></use></svg>
              <div class="dropdown-item-label">Revoke Admin Rights</div>
            </div>
          {{/if}}
          {{#if allow_member_remove user_id}}
            {{#if is_current_user user_id}}
              <div class="dropdown-item leave">
                <svg class="jd-icon-dropdown text-dark"><use xlink:href="/layout/icons-feather-sprite.svg#log-out"></use></svg>
                <div class="dropdown-item-label">Leave</div>
              </div>
            {{else}}
              <div class="dropdown-item remove">
                <svg class="jd-icon-dropdown text-dark"><use xlink:href="/layout/icons-feather-sprite.svg#trash"></use></svg>
                <div class="dropdown-item-label">Remove</div>
              </div>
            {{/if}}
          {{/if}}
        </div>
      </div>
    {{/if}}
  </li>
</template>

<template name="regular_member_item">
  <li class="member-item regular-member-item" user-id="{{_id}}">
    <div class="d-flex align-items-center">
      <div class="select-icon"></div>
      {{> gtpl_user_profile_pic}}
      <div class="display-name mx-2">{{> display_name_with_graphic_unverified_warning}}</div>
    </div>
    {{#if allow_show_member_dropdown_settings user_id}}
      <div class="member-settings-dropdown">
        <div class="member-role-label text-primary">Member</div>
        <svg class="jd-icon text-secondary member-settings-dropdown-btn"><use xlink:href="/layout/icons-feather-sprite.svg#more-vertical"></use></svg>
        <div class="member-settings-dropdown-menu animate slideIn">
          {{#if is_project_admin}}
            <div class="dropdown-item upgrade-admin">
              <svg class="jd-icon-dropdown text-dark"><use xlink:href="/layout/icons-feather-sprite.svg#star"></use></svg>
              <div class="dropdown-item-label">Make an Admin</div>
            </div>
            <div class="dropdown-item make-guest">
              <svg class="jd-icon-dropdown text-dark"><use xlink:href="/layout/icons-feather-sprite.svg#chevron-down"></use></svg>
              <div class="dropdown-item-label">Make a Guest</div>
            </div>
          {{/if}}
          {{#if allow_member_remove user_id}}
            {{#if is_current_user user_id}}
              <div class="dropdown-item leave">
                <svg class="jd-icon-dropdown text-dark"><use xlink:href="/layout/icons-feather-sprite.svg#log-out"></use></svg>
                <div class="dropdown-item-label">Leave</div>
              </div>
            {{else}}
              <div class="dropdown-item remove">
                <svg class="jd-icon-dropdown text-dark"><use xlink:href="/layout/icons-feather-sprite.svg#trash"></use></svg>
                <div class="dropdown-item-label">Remove</div>
              </div>
            {{/if}}
          {{/if}}
        </div>
      </div>
    {{/if}}
  </li>
</template>

<template name="guest_member_item">
  <li class="member-item regular-member-item" user-id="{{_id}}">
    <div class="d-flex align-items-center">
      <div class="select-icon"></div>
      {{> gtpl_user_profile_pic}}
      <div class="display-name mx-2">{{> display_name_with_graphic_unverified_warning}}</div>
    </div>
    {{#if allow_show_member_dropdown_settings user_id}}
      <div class="member-settings-dropdown">
        <div class="member-role-label text-primary">Guest</div>
        <svg class="jd-icon text-secondary member-settings-dropdown-btn"><use xlink:href="/layout/icons-feather-sprite.svg#more-vertical"></use></svg>
        <div class="member-settings-dropdown-menu animate slideIn">
          {{#if is_project_admin}}
            <div class="dropdown-item upgrade-guest">
              <svg class="jd-icon-dropdown text-dark"><use xlink:href="/layout/icons-feather-sprite.svg#chevron-up"></use></svg>
              <div class="dropdown-item-label">Make a Member</div>
            </div>
          {{/if}}
          {{#if allow_member_remove user_id}}
            {{#if is_current_user user_id}}
              <div class="dropdown-item leave">
                <svg class="jd-icon-dropdown text-dark"><use xlink:href="/layout/icons-feather-sprite.svg#log-out"></use></svg>
                <div class="dropdown-item-label">Leave</div>
              </div>
            {{else}}
              <div class="dropdown-item remove">
                <svg class="jd-icon-dropdown text-dark"><use xlink:href="/layout/icons-feather-sprite.svg#trash"></use></svg>
                <div class="dropdown-item-label">Remove</div>
              </div>
            {{/if}}
          {{/if}}
        </div>
      </div>
    {{/if}}
  </li>
</template>

<template name="enrollment_pending_member">
  <li class="member-item enrollment-pending-member-item" user-id="{{_id}}">
    <div class="d-flex align-items-center">
      <div class="select-icon"></div>
      {{> gtpl_user_profile_pic}}
      <div class="display-name mx-2" title="{{userEmail this}}">{{displayName}}</div>
    </div>
    <div class="member-settings-dropdown">
      <div class="member-role-label text-primary">Invited</div>
      <svg class="jd-icon text-secondary member-settings-dropdown-btn"><use xlink:href="/layout/icons-feather-sprite.svg#more-vertical"></use></svg>
      <div class="member-settings-dropdown-menu animate slideIn">
        {{#if allow_member_edit_enrollment_pending_member user_id}}
          <div class="dropdown-item edit-enrolled">
            {{#if is_project_admin}}
              <svg class="jd-icon-dropdown text-dark"><use xlink:href="/layout/icons-feather-sprite.svg#edit-3"></use></svg>
              <div class="dropdown-item-label">Edit</div>
            {{else}}
              <svg class="jd-icon-dropdown text-dark"><use xlink:href="/layout/icons-feather-sprite.svg#info"></use></svg>
              <div class="dropdown-item-label">Info</div>
            {{/if}}
          </div>
        {{/if}}
        {{#unless is_guest}}
          {{#if is_project_admin}}
            <div class="dropdown-item {{#if is_admin}}downgrade-admin{{else}}upgrade-admin{{/if}}">
              <svg class="jd-icon-dropdown text-dark"><use xlink:href="/layout/icons-feather-sprite.svg#star"></use></svg>
              <div class="dropdown-item-label">{{#if is_admin}}Revoke Admin Rights{{else}}Make an Admin upon registration{{/if}}</div>
            </div>
          {{/if}}
        {{/unless}}
        {{#if allow_member_remove user_id}}
          {{#if is_current_user user_id}}
            <div class="dropdown-item leave">
              <svg class="jd-icon-dropdown text-dark"><use xlink:href="/layout/icons-feather-sprite.svg#log-out"></use></svg>
              <div class="dropdown-item-label">Leave</div>
            </div>
          {{else}}
            <div class="dropdown-item remove">
              <svg class="jd-icon-dropdown text-dark"><use xlink:href="/layout/icons-feather-sprite.svg#trash"></use></svg>
              <div class="dropdown-item-label">Remove</div>
            </div>
          {{/if}}
        {{/if}}
      </div>
    </div>
  </li>
</template>

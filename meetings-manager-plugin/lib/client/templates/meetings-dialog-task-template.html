<template name="meetings_dialog_task">
  <div class="meetings_dialog-task d-flex mb-2">
    <small class="text-muted mr-2 mt-2">{{index}}</small>

    <!-- Task Dialog tab -->
    <div class="dialog-task-item bg-white p-2 flex-grow-1 rounded-sm">
      <!-- Seq id, task title, task-controls -->
      <div class="d-flex align-items-start">
        <small class="task-seqId bg-light border rounded-sm px-1">{{item.seqId}}</small>
        <div class="task-title flex-grow-1 px-2" dir="auto">
          {{task.title}}
          <!-- {{#with lookupUser task.owner_id}}
            ({{displayName}})
          {{/with}} -->
        </div>
        <div class="task-controls-container d-flex align-items-center">
          {{#if allowAddingNotes}}
            <div class="btn-group add-note-group">
<!--              disabeling adding private note from now, in order to keep the product simple-->
<!--              {{#unless hasPrivateNote}}-->
<!--                <div class="btn-add-private-note"><i class="fa fa-user-secret" aria-hidden="true" title="Add a private note"></i></div>-->
<!--              {{/unless}}-->
              {{#unless hasNoAccessToTask}}
                <div class="btn-add-task">
                  <svg class="jd-icon jd-c-pointer text-dark">
                    <use xlink:href="/layout/icons-feather-sprite.svg#plus"></use>
                    <title>Add Task</title>
                  </svg>
                </div>
              {{/unless}}
            </div>
          {{/if}}
          {{#if allowSortingNotes}}
            <svg class="jd-icon jd-c-pointer text-dark btn-agenda-edit remove-task"><use xlink:href="/layout/icons-feather-sprite.svg#trash"/></svg>
            <svg class="jd-icon jd-c-pointer text-dark btn-agenda-edit sort-task"><use xlink:href="/layout/icons-feather-sprite.svg#menu"/></svg>
          {{/if}}

          <!-- {{#if mayEdit}}
            {{#unless firstItem}}
              <span class="fa fa-chevron-up move move-up"></span>
            {{/unless}}
            {{#unless lastItem}}
              <span class="fa fa-chevron-down move move-down"></span>
            {{/unless}}
          {{/if}} -->
        </div>
      </div>

      <!-- Private note (backward compatible, currently inactive) -->
      {{#if private_note}}
        <div class="task-private-note task-user-note">
          <div class="user mb-1"><i class="fa fa-user-secret" aria-hidden="true"></i> My private note:</div>
          <span class="note">
            <textarea name="private_note" class="note-box form-control" dir="auto"></textarea>
          </span>
        </div>
      {{/if}}


      <!-- User note (backward compatible, currently inactive)-->
      {{#each userNotes}}
        <div class="task-user-note">
          <span class="user">
            {{#with lookupUser this.user_id}}
              {{displayName}}:
            {{/with}}
          </span>
          <span class="note">
            {{#if isSelf this.user_id}}
              {{!--
              IMPORTANT: we use jquery to set the contents of this
              textarea because otherwise there's a race condition when we
              update the value of the textarea.
               --}}
              <textarea name="user_notes.{{this.user_id}}" class="note-box form-control" dir="auto"></textarea>
            {{else}}
              <pre class="note-box">{{notesForUser this.user_id}}</pre>
            {{/if}}
          </span>
        </div>
      {{/each}}

      <!-- Task summary -->
      <div class="summary-note-wrapper">
        {{#if displayTaskNote}}
          <div class="task-summary-note">
            {{> locking_text_editor content=meeting_task.note class="note" placeholder="Task's note" lock=meeting_task.note_lock disabled=mayNotEditTaskNote onSave=onSaveTaskNote}}
          </div>
        {{/if}}
      </div>

      <!-- Added tasks -->
      {{#if meeting_task.added_tasks}}
        <div class="task-added-tasks task-user-note">
          <span class="user">
            <span class="user-pic">Added tasks</span>
          </span>
          <span class="note">
            {{#each meeting_task.added_tasks}}
              {{#with lookupTask}}
                <div class="sub-task d-flex align-items-start mt-2">
                  {{> meetings_dialog_task_subtask task_id=this._id parent_task_id=taskId meeting_id=meetingId may_edit=mayEditChildTask}}
                </div>
              {{/with}}
            {{/each}}
          </span>
        </div>
      {{/if}}




      <!-- Error -->
      <div class="errors">
        {{#each errors}}
          <div class="error">
            {{message}}
          </div>
        {{/each}}
      </div>

    </div>

  </div>
</template>
